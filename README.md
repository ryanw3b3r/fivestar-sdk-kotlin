# FiveStar Support SDK for Android / Kotlin

[![Kotlin](https://img.shields.io/badge/Kotlin-1.9+-blue.svg)](https://kotlinlang.org)
[![Android](https://img.shields.io/badge/API-21+-green.svg)](https://developer.android.com)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

Kotlin/Android SDK for integrating FiveStar Support feedback collection into your applications.

## Features

- **Server-Side Customer ID Generation**: Secure customer IDs generated by the server
- **Response Types**: Fetch available feedback categories (bug, feature request, etc.)
- **Feedback Submission**: Submit bug reports and feature requests
- **Type-Safe Models**: kotlinx.serialization for full type safety
- **Kotlin Coroutines**: Built-in async support

## Requirements

- Kotlin 1.9+
- Java 11+
- Android API 21+ (Android 5.0 Lollipop)

## Installation

Add the dependency to your `build.gradle.kts`:

```kotlin
dependencies {
    implementation("com.fivestar.support:fivestar-support:1.1.0")
}
```

Or `build.gradle`:

```groovy
dependencies {
    implementation 'com.fivestar.support:fivestar-support:1.1.0'
}
```

## Quick Start

```kotlin
import com.fivestar.support.*
import kotlinx.coroutines.*

// Initialize the client
val client = FiveStarClient(
    clientId = "your-client-id",
    platform = "android",         // 'web', 'ios', 'android', 'flutter', 'laravel'
    appVersion = "1.0.0"
)

// Generate a customer ID from the server
scope.launch {
    val result = client.generateCustomerId()
    val customerId = result.customerId

    // Register the customer
    val customerResult = client.registerCustomer(
        customerId = customerId,
        options = RegisterCustomerOptions(
            email = "user@example.com",
            name = "John Doe"
        )
    )

    if (customerResult.success) {
        println("Customer registered: ${customerResult.customer?.customerId}")
    }
}

// Get available response types
scope.launch {
    val types = client.getResponseTypes()
    println("Available types: ${types.map { it.name }}")

    // Submit feedback
    val response = client.submitResponse(SubmitResponseOptions(
        customerId = customerId,
        title = "App crashes on launch",
        description = "The app crashes immediately after opening",
        typeId = types.first().id
    ))

    println("Response submitted: ${response.responseId}")
}

// Clean up
client.close()
```

## Usage

### Initialization

```kotlin
val client = FiveStarClient(
    clientId = "your-client-id",
    apiUrl = "https://fivestar.support",  // optional
    platform = "android",                  // optional: 'web', 'ios', 'android', etc.
    appVersion = "1.0.0",                  // optional
    deviceModel = "Pixel 7",               // optional
    osVersion = "13"                       // optional
)
```

### Generate Customer ID

Customer IDs are now generated server-side with cryptographic signing:

```kotlin
scope.launch {
    val result = client.generateCustomerId()

    println("Customer ID: ${result.customerId}")
    println("Expires At: ${result.expiresAt}")
    println("Device ID: ${result.deviceId}")
}
```

### Register Customer

```kotlin
scope.launch {
    client.registerCustomer(
        customerId = customerId,
        options = RegisterCustomerOptions(
            email = "user@example.com",
            name = "John Doe"
        )
    )
}
```

### Get Response Types

```kotlin
scope.launch {
    val types = client.getResponseTypes()
    // Returns: List<ResponseType> with id, name, slug, color, icon
}
```

### Submit Feedback

```kotlin
scope.launch {
    val response = client.submitResponse(SubmitResponseOptions(
        customerId = customerId,
        title = "Feature Request: Dark mode",
        description = "Please add dark mode support",
        typeId = types.first().id
    ))

    if (response.success) {
        println("Response submitted: ${response.responseId}")
    }
}
```

### Verify Customer ID

```kotlin
scope.launch {
    val result = client.verifyCustomer(customerId)

    if (result.valid) {
        println("Customer ID is valid and registered")
    } else {
        println("Verification failed: ${result.message}")
    }
}
```

### Public URL Generation

```kotlin
// Default (no locale)
val url = client.getPublicUrl()
// => "https://fivestar.support/c/your-client-id"

// With locale
val localizedUrl = client.getPublicUrl("fr")
// => "https://fivestar.support/fr/c/your-client-id"
```

## API Reference

### FiveStarClient

Main client for interacting with the FiveStar Support API.

#### Initialization

```kotlin
val client = FiveStarClient(
    clientId = "your-client-id",
    apiUrl = "https://fivestar.support",  // optional
    platform = "android",                 // optional
    appVersion = "1.0.0",                 // optional
    deviceModel = "Pixel 7",              // optional
    osVersion = "13"                      // optional
)
```

| Parameter     | Type      | Default                      | Description         |
| ------------- | --------- | ---------------------------- | ------------------- |
| `clientId`    | `String`  | _required_                   | Your client UUID    |
| `apiUrl`      | `String`  | `"https://fivestar.support"` | API base URL        |
| `platform`    | `String?` | `null`                       | Platform identifier |
| `appVersion`  | `String?` | `null`                       | App version string  |
| `deviceModel` | `String?` | `null`                       | Device model        |
| `osVersion`   | `String?` | `null`                       | OS version          |

#### Methods

| Method                                  | Description                            |
| --------------------------------------- | -------------------------------------- |
| `getResponseTypes()`                    | Get all available response types       |
| `generateCustomerId()`                  | Generate a new customer ID from server |
| `registerCustomer(customerId, options)` | Register a customer ID                 |
| `verifyCustomer(customerId)`            | Verify a customer ID                   |
| `submitResponse(options)`               | Submit a new response/feedback         |
| `getPublicUrl(locale)`                  | Get public feedback page URL           |
| `close()`                               | Close the HTTP client                  |

### Data Models

#### GenerateCustomerIdResult

```kotlin
data class GenerateCustomerIdResult(
    val customerId: String,    // The server-generated customer ID
    val expiresAt: String,     // ISO datetime when ID expires
    val deviceId: String       // Short device identifier
)
```

#### RegisterCustomerOptions

```kotlin
data class RegisterCustomerOptions(
    val email: String? = null,  // Optional: Customer email
    val name: String? = null    // Optional: Customer name
)
```

#### SubmitResponseOptions

```kotlin
data class SubmitResponseOptions(
    val customerId: String,     // Required: Customer ID
    val title: String,          // Required: Feedback title
    val description: String,    // Required: Feedback description
    val typeId: String,         // Required: Response type ID
    val email: String? = null,  // Optional: Customer email
    val name: String? = null    // Optional: Customer name
)
```

#### VerifyCustomerResult

```kotlin
data class VerifyCustomerResult(
    val valid: Boolean,         // Whether the customer ID is valid
    val message: String? = null // Optional message
)
```

#### ResponseType

```kotlin
data class ResponseType(
    val id: String,
    val name: String,
    val slug: String,
    val color: String,
    val icon: String
)
```

## Error Handling

All suspend methods can throw `FiveStarAPIError`:

```kotlin
try {
    val types = client.getResponseTypes()
} catch (e: FiveStarAPIError) {
    println("API Error: ${e.message}")
    if (e.statusCode != null) {
        println("Status Code: ${e.statusCode}")
    }
}
```

### Customer ID Generation

```kotlin
val result = client.generateCustomerId()
val customerId = result.customerId
```

### Registration

```kotlin
// Same API, but customerId now comes from server
client.registerCustomer(
    customerId = customerId,
    options = RegisterCustomerOptions(
        email = "user@example.com",
        name = "John Doe"
    )
)
```

## License

MIT License - see LICENSE file for details.

## Support

- Documentation: https://fivestar.support
- GitHub Issues: https://github.com/ryanw3b3r/fivestar-sdk-kotlin/issues
